# 🌐 מפת הגדרות שפה ותרגום - eScriptorium BiblIA
**גרסה ויזואלית**

```
┌─────────────────────────────────────────────────────────────────┐
│                    🌍 LANGUAGE & i18n SYSTEM                    │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────┐
│  1. IMPORTS      │
└──────────────────┘
    ↓
┌──────────────────────────────────────────────────────────────┐
│ from django.utils.translation import gettext_lazy as _      │
│ ✓ פונקציית תרגום בסיסית                                     │
└──────────────────────────────────────────────────────────────┘


┌──────────────────┐
│  2. APPS         │
└──────────────────┘
    ↓
┌──────────────────────────────────────────────────────────────┐
│ INSTALLED_APPS = [                                           │
│   'language_flags',          # 🏳️  דגלי שפות                │
│   'apps.language_support',   # 🇮🇱 תמיכה בעברית (מותאם)     │
│   'biblia_templatetags',     # 📝 template tags (מותאם)     │
│ ]                                                            │
└──────────────────────────────────────────────────────────────┘


┌──────────────────┐
│  3. MIDDLEWARE   │
└──────────────────┘
    ↓
┌──────────────────────────────────────────────────────────────┐
│ MIDDLEWARE = [                                               │
│   'django.middleware.locale.LocaleMiddleware',  # ← KEY!    │
│   # ↑ זיהוי שפה מ-cookie/session/header                     │
│   ...                                                        │
│   'clean_biblia_middleware_v2.CleanBibliaMiddlewareV2',     │
│   # ↑ תרגום HTML נוסף (מותאם, לא תקני)                     │
│ ]                                                            │
└──────────────────────────────────────────────────────────────┘


┌───────────────────────┐
│  4. CONTEXT PROCESSOR │
└───────────────────────┘
    ↓
┌──────────────────────────────────────────────────────────────┐
│ TEMPLATES[0]['OPTIONS']['context_processors'] = [           │
│   'biblia_translation_processor.biblia_translations',       │
│   # ↑ תרגומים נוספים זמינים בכל template                   │
│ ]                                                            │
└──────────────────────────────────────────────────────────────┘


┌──────────────────┐
│  5. i18n SETTINGS│
└──────────────────┘
    ↓
┌──────────────────────────────────────────────────────────────┐
│ LANGUAGE_CODE = 'he'           # 🇮🇱 עברית כדיפולט          │
│ USE_I18N = True                # ✓ הפעלת תרגומים            │
│ USE_L10N = True                # ✓ פורמטים מקומיים          │
│ USE_TZ = True                  # ✓ time zones               │
│                                                              │
│ ESC_LANGUAGES = 'en,he'.split(',')  # שפות פעילות          │
│                                                              │
│ LANGUAGES = [                  # רשימת בחירה:               │
│   ('en', 'English'),                                        │
│   ('he', 'Hebrew'),            # ← הוספנו!                  │
│   ('fr', 'French'),            # אופציונלי                  │
│   ('de', 'German'),            # אופציונלי                  │
│ ]                                                            │
│                                                              │
│ LOCALE_PATHS = ['app/locale'] # 📁 איפה התרגומים            │
└──────────────────────────────────────────────────────────────┘


═════════════════════════════════════════════════════════════════
                    🔄 זרימת REQUEST → RESPONSE
═════════════════════════════════════════════════════════════════

     ┌─────────────┐
     │   User      │
     │  Request    │
     └──────┬──────┘
            │
            ↓
┌───────────────────────────┐
│ 1. LocaleMiddleware       │
│    • קורא cookie          │
│    • מזהה שפה: 'he'       │
│    • מגדיר language code  │
└───────────┬───────────────┘
            │
            ↓
┌───────────────────────────┐
│ 2. Django קורא תרגומים   │
│    • LOCALE_PATHS         │
│    • locale/he/django.mo  │
└───────────┬───────────────┘
            │
            ↓
┌───────────────────────────┐
│ 3. View מעבד              │
│    • gettext(_) מתרגם    │
└───────────┬───────────────┘
            │
            ↓
┌───────────────────────────┐
│ 4. Template מתרגם         │
│    • {% trans "text" %}   │
│    • {{ _("text") }}      │
└───────────┬───────────────┘
            │
            ↓
┌───────────────────────────┐
│ 5. Context Processor      │
│    • מוסיף תרגומים נוספים│
└───────────┬───────────────┘
            │
            ↓
┌───────────────────────────┐
│ 6. CleanBibliaMiddleware  │
│    • תיקוני HTML אחרונים │
└───────────┬───────────────┘
            │
            ↓
     ┌──────────────┐
     │   Response   │
     │  🇮🇱 בעברית  │
     └──────────────┘


═════════════════════════════════════════════════════════════════
                    📁 מבנה קבצי תרגום
═════════════════════════════════════════════════════════════════

app/
├── locale/                      # ← LOCALE_PATHS מצביע לכאן
│   ├── he/                      # 🇮🇱 עברית
│   │   └── LC_MESSAGES/
│   │       ├── django.po        # 📝 קובץ מקור (2,070 שורות)
│   │       └── django.mo        # 🔧 קומפייל (binary)
│   ├── en/                      # 🇬🇧 אנגלית
│   │   └── LC_MESSAGES/
│   │       └── ...
│   └── fr/                      # 🇫🇷 צרפתית (אופציונלי)
│       └── LC_MESSAGES/
│           └── ...
│
├── apps/
│   └── language_support/        # 🔧 app מותאם לעברית
│       ├── __init__.py
│       └── ...
│
├── biblia_templatetags/         # 📝 template tags
│   ├── __init__.py
│   └── templatetags/
│       └── ...
│
├── biblia_translation_processor.py  # 🎯 context processor
└── clean_biblia_middleware_v2.py    # ⚙️ middleware


═════════════════════════════════════════════════════════════════
                    🎨 דוגמאות שימוש
═════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────┐
│ 1. בקוד Python (views.py):                                 │
├─────────────────────────────────────────────────────────────┤
│ from django.utils.translation import gettext as _          │
│                                                             │
│ def my_view(request):                                      │
│     message = _("Welcome")  # → "ברוכים הבאים"             │
│     return render(request, 'page.html', {                  │
│         'message': message                                 │
│     })                                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 2. בTemplate (HTML):                                        │
├─────────────────────────────────────────────────────────────┤
│ {% load i18n %}                                             │
│                                                             │
│ <h1>{% trans "Welcome" %}</h1>                             │
│ <!-- → <h1>ברוכים הבאים</h1> -->                           │
│                                                             │
│ <p>{% blocktrans %}                                        │
│    Hello {{ user }}!                                        │
│ {% endblocktrans %}</p>                                    │
│ <!-- → <p>שלום משתמש!</p> -->                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 3. בSettings (קבוע):                                        │
├─────────────────────────────────────────────────────────────┤
│ LANGUAGES = [                                               │
│     ('en', _('English')),  # מתורגם לפי LANGUAGE_CODE      │
│     ('he', _('Hebrew')),                                    │
│ ]                                                           │
└─────────────────────────────────────────────────────────────┘


═════════════════════════════════════════════════════════════════
                    🔧 מה שינינו vs מה היה
═════════════════════════════════════════════════════════════════

┌──────────────────────────┬────────────────┬──────────────────┐
│ הגדרה                    │ לפני           │ אחרי             │
├──────────────────────────┼────────────────┼──────────────────┤
│ LANGUAGE_CODE            │ 'en-us'        │ 'he'      [✓]    │
│ ESC_LANGUAGES            │ 'en'           │ 'en,he'   [✓]    │
│ LANGUAGES                │ [('en',...)]   │ +('he',...) [✓]  │
│ apps.language_support    │ ❌ לא היה      │ ✓ נוסף    [✓]    │
│ biblia_templatetags      │ ❌ לא היה      │ ✓ נוסף    [✓]    │
│ CleanBibliaMiddleware    │ ❌ לא היה      │ ✓ נוסף    [⚠️]   │
│ biblia_translation_proc  │ ❌ לא היה      │ ✓ נוסף    [✓]    │
│ LocaleMiddleware         │ ✓ היה          │ ✓ נשאר    [✓]    │
│ LOCALE_PATHS             │ ✓ היה          │ ✓ נשאר    [✓]    │
└──────────────────────────┴────────────────┴──────────────────┘

[✓] = מעולה
[⚠️] = עובד אבל לא אידיאלי


═════════════════════════════════════════════════════════════════
                    ✅ מה עובד / ⚠️ מה צריך שיפור
═════════════════════════════════════════════════════════════════

✅ עובד מצוין:
  • Django i18n תקני
  • LocaleMiddleware זיהוי שפה
  • קבצי .po/.mo תרגום
  • LANGUAGE_CODE = 'he'
  • apps נפרדים (language_support, biblia_templatetags)
  • context processor

⚠️ צריך שיפור:
  • CleanBibliaMiddleware - לא תקני, כדאי להחליף
  • חסר תיעוד מפתחים
  • חסרים unit tests

🟢 רמת איכות כוללת: 4.5/5


═════════════════════════════════════════════════════════════════
                    📝 סיכום בשורה אחת
═════════════════════════════════════════════════════════════════

    settings.py מגדיר בסיס מעולה עם Django i18n תקני + 
    תוספות מותאמות לעברית בארכיטקטורה נכונה! ✅

═════════════════════════════════════════════════════════════════
```

**קבצים לעיון:**
- 📄 `LANGUAGE_SETTINGS_EXPLAINED.md` - הסבר מפורט
- 📄 `SETTINGS_DEEP_AUDIT.md` - ביקורת settings.py
- 📄 `HEBREW_TRANSLATION_FINAL_REPORT.md` - דוח תרגום

**תאריך:** 17 באוקטובר 2025
