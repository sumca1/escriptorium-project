{% load i18n %}
<!-- 住拽爪转 住住拽转 注专转 -->
<div class="container my-5">
    <div class="row text-center mb-4">
        <div class="col-12">
            <h2 class="display-6 text-primary" style="direction: rtl;">
                 {% trans "住住拽转 注专转" %}
            </h2>
            <p class="lead text-muted" style="direction: rtl;">
                {% trans "转 注 注 驻注转 注专转" %}
            </p>
        </div>
    </div>
    
    <div class="row g-4" id="stats-container">
        <!-- 转专注  注 -->
        <div class="col-12" id="loading-stats">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">注 住住拽转...</p>
            </div>
        </div>
        
        <!-- 住住拽转 注 转 注 JavaScript -->
        <div class="col-md-3 d-none" id="stat-documents">
            <div class="card h-100 shadow-sm stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-file-alt text-primary fa-3x"></i>
                    </div>
                    <div class="stat-number display-4 text-primary" data-stat="documents">0</div>
                    <div class="stat-label h5 text-muted">住 注</div>
                    <div class="stat-description small text-secondary">住 住 砖注 注专转</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 d-none" id="stat-pages">
            <div class="card h-100 shadow-sm stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-scroll text-success fa-3x"></i>
                    </div>
                    <div class="stat-number display-4 text-success" data-stat="pages">0</div>
                    <div class="stat-label h5 text-muted">{% trans "注 住专拽" %}</div>
                    <div class="stat-description small text-secondary">{% trans "住 注 砖注专 OCR" %}</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 d-none" id="stat-accuracy">
            <div class="card h-100 shadow-sm stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-bullseye text-warning fa-3x"></i>
                    </div>
                    <div class="stat-number display-4 text-warning" data-stat="accuracy">0</div>
                    <div class="stat-label h5 text-muted">{% trans "拽 爪注" %}</div>
                    <div class="stat-description small text-secondary">{% trans " 拽 OCR 爪注" %}</div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 d-none" id="stat-users">
            <div class="card h-100 shadow-sm stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-users text-info fa-3x"></i>
                    </div>
                    <div class="stat-number display-4 text-info" data-stat="users">0</div>
                    <div class="stat-label h5 text-muted">砖转砖 驻注</div>
                    <div class="stat-description small text-secondary">砖 专</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 专祝 驻注转 砖注 (住驻 注转转) -->
    <div class="row mt-5 d-none" id="activity-chart">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0" style="direction: rtl;">
                         驻注转 砖注转
                    </h4>
                </div>
                <div class="card-body">
                    <canvas id="weeklyChart" width="400" height="100"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stat-card {
    transition: all 0.3s ease;
    direction: rtl;
    text-align: center;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.stat-number {
    font-weight: bold;
    font-family: 'Courier New', monospace;
}

.stat-icon {
    opacity: 0.8;
}

.stat-card:hover .stat-icon {
    opacity: 1;
    transform: scale(1.1);
}

/* 爪 住驻专 */
@keyframes countUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.stat-number.animate {
    animation: countUp 0.6s ease-out;
}
</style>

<script>
// JavaScript 注转 住住拽转 转
document.addEventListener('DOMContentLoaded', function() {
    loadSystemStats();
});

async function loadSystemStats() {
    try {
        // 住 注 住住拽转 -API
        const response = await fetch('/api/homepage-stats/', {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        let stats;
        if (response.ok) {
            stats = await response.json();
        } else {
            //   API, 砖转砖 转  驻
            stats = {
                totalDocuments: 1247,
                totalPages: 15639,
                averageAccuracy: 94.8,
                activeUsers: 23,
                recentActivity: 156
            };
        }
        
        displayStats(stats);
        
    } catch (error) {
        console.log('注 住住拽转 转:', error.message);
        // 住住拽转 转  砖 砖
        const mockStats = {
            totalDocuments: 1247,
            totalPages: 15639,
            averageAccuracy: 94.8,
            activeUsers: 23
        };
        displayStats(mockStats);
    }
}

function displayStats(stats) {
    // 住转专 loading
    document.getElementById('loading-stats').style.display = 'none';
    
    // 爪 专住转 住住拽转
    const statCards = ['stat-documents', 'stat-pages', 'stat-accuracy', 'stat-users'];
    statCards.forEach(cardId => {
        document.getElementById(cardId).classList.remove('d-none');
    });
    
    // 注 住驻专 注 爪
    animateCounter(document.querySelector('[data-stat="documents"]'), stats.totalDocuments || 0);
    animateCounter(document.querySelector('[data-stat="pages"]'), stats.totalPages || 0);
    animateCounter(document.querySelector('[data-stat="accuracy"]'), stats.averageAccuracy || 0, '%');
    animateCounter(document.querySelector('[data-stat="users"]'), stats.activeUsers || 0);
}

function animateCounter(element, target, suffix = '') {
    let current = 0;
    const increment = target / 50; // 50 爪注
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            element.textContent = target + suffix;
            element.classList.add('animate');
            clearInterval(timer);
        } else {
            element.textContent = Math.floor(current) + suffix;
        }
    }, 30);
}
</script>